<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ai Pazar - Dijital Vicdan v27 (Tahliye)</title>
    <style>
        :root { --primary: #4285f4; --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); text-align: center; padding: 20px; }
        .container { background: var(--card); display: inline-block; padding: 40px; border-radius: 30px; border: 2px solid var(--primary); max-width: 600px; width: 90%; box-shadow: 0 20px 50px rgba(0,0,0,0.7); margin-top: 50px; }
        h1 { color: var(--primary); margin-bottom: 10px; font-size: 28px; text-transform: uppercase; }
        #status { color: #f1c40f; margin: 15px 0; font-size: 16px; min-height: 24px; font-weight: 500; }
        .mic-btn { background: var(--primary); color: white; width: 80px; height: 80px; border-radius: 50%; font-size: 35px; border: none; cursor: pointer; transition: 0.3s; margin-bottom: 20px; }
        .input-group { display: flex; gap: 10px; margin-top: 20px; }
        input[type="text"] { flex: 1; padding: 15px; border-radius: 12px; border: 1px solid #333; background: #2b2b2b; color: white; outline: none; }
        .send-btn { background: #34a853; color: white; padding: 0 25px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; }
        #aiResponse { background: #252525; padding: 25px; border-radius: 20px; margin-top: 30px; text-align: left; line-height: 1.7; min-height: 80px; border-left: 6px solid var(--primary); }
        #errorLog { margin-top: 20px; background: #441111; color: #ffbaba; padding: 15px; border-radius: 10px; font-size: 14px; display: none; text-align: left; border: 1px solid #ff4444; }
    </style>
</head>
<body>

<div class="container">
    <h1>üöÄ Ai Pazar Canlƒ±</h1>
    <div id="status">Baƒülantƒ± Hazƒ±r...</div>
    <button id="startBtn" class="mic-btn">üéôÔ∏è</button>
    <div class="input-group">
        <input type="text" id="userInput" placeholder="Mesajƒ±nƒ±zƒ± yazƒ±n...">
        <button id="sendBtn" class="send-btn">G√ñNDER</button>
    </div>
    <div id="aiResponse">Cevap bekleniyor...</div>
    <div id="errorLog"></div>
</div>

<script>
    // BURAYA API ANAHTARINI KOY
    var API_KEY = "AIzaSyChUn6h6F15AoWM1Huu2BgRVOQx0BEyuPw"; 

    var startBtn = document.getElementById('startBtn');
    var sendBtn = document.getElementById('sendBtn');
    var userInput = document.getElementById('userInput');
    var statusText = document.getElementById('status');
    var aiResponse = document.getElementById('aiResponse');
    var errorLog = document.getElementById('errorLog');

    function showLog(msg) {
        errorLog.style.display = "block";
        errorLog.innerHTML = "‚ö†Ô∏è <b>Sistem Notu:</b> " + msg;
    }

    var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        var recognition = new SpeechRecognition();
        recognition.lang = 'tr-TR';
        startBtn.onclick = function() {
            errorLog.style.display = "none";
            recognition.start();
            statusText.innerText = "Dinliyorum...";
        };
        recognition.onresult = function(event) {
            var text = event.results[0][0].transcript;
            userInput.value = text;
            askGemini(text);
        };
    }

    sendBtn.onclick = function() { if (userInput.value.trim() !== "") askGemini(userInput.value); };

    async function askGemini(soru) {
        statusText.innerText = "Gemini D√º≈ü√ºn√ºyor...";
        aiResponse.innerText = "...";
        errorLog.style.display = "none";

        // G√úNCELLENEN URL VE MODEL PARAMETRELERƒ∞
        var apiUrl = "https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=" + API_KEY;
        
        try {
            var response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: soru }] }] })
            });

            var data = await response.json();

            if (data.error) {
                // Eƒüer v1 gemini-pro da olmazsa otomatik v1beta gemini-pro denemesi i√ßin not d√º≈ü√ºyoruz
                showLog("API Hatasƒ±: " + data.error.message);
                aiResponse.innerText = "Cevap alƒ±namadƒ±.";
                return;
            }

            if (data.candidates && data.candidates[0]) {
                var reply = data.candidates[0].content.parts[0].text;
                aiResponse.innerText = reply;
                statusText.innerText = "Yanƒ±t Geldi.";
                var utter = new SpeechSynthesisUtterance(reply);
                utter.lang = 'tr-TR';
                window.speechSynthesis.speak(utter);
            }
        } catch (err) {
            showLog("Baƒülantƒ± Hatasƒ±!");
        }
    }
</script>
</body>
</html>
